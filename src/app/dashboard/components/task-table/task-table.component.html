<div class="container" *ngIf="parentTaskData">
    <table class="table table-striped table-bordered">
        <thead>
            <!-- Header Row -->
            <ng-container *ngTemplateOutlet="headers"></ng-container>
        </thead>
        <tbody>
            <!-- Main Rows with Expandable Child Panels -->
            <ng-container *ngFor="let task of parentTaskData; let i = index">

                <ng-container *ngTemplateOutlet="tableRows; context: {$implicit: task}"></ng-container>
            </ng-container>
        </tbody>
    </table>
</div>


<ng-template #headers>
    <tr>
        <th scope="col">Child</th>
        <th scope="col">Task Name</th>
        <th scope="col" class="col-sm-3" >Description</th>
        <th scope="col">Owner</th>
        <th scope="col">Assigned To</th>
        <th scope="col">ETA</th>
        <th scope="col">Status</th>
        <th scopr="col">End Date</th>
        <th scope="col">Action</th>
    </tr>
</ng-template>


<ng-template #tableRows let-task>
    <tr>
        <th scope="row" (click)="toggleChildTable(task)">
            <span *ngIf="!showChildTable.get(task.taskId)" class="fa-solid fa-plus"></span>
            <span *ngIf="showChildTable.get(task.taskId)" class="fa-solid fa-minus"></span>
        </th>
        <td for="taskName" data-toggle="tooltip" data-placement="right" title="{{task.taskDescription}}">{{ task.taskName }}</td>
        <td >{{ task.taskDescription }}</td>
        <td>
            <ng-container *ngFor="let employee of employees">
                <ng-container *ngIf="employee.employeeId === task.taskCreatedBy">
                    {{employee.firstName}}
                </ng-container>
            </ng-container>

        </td>
        <td>
            <select id="assignedToEmployeeId" name="assignedToEmployeeId" [(ngModel)]="task.taskAssignedTo" required
                class="form-control">
                <option value="undefined" selected>Select Employee</option>
                <!-- Loop through the 'employees' array and display each employee as an option -->
                <option *ngFor="let employee of employees" [value]="employee.employeeId">{{
                    employee.firstName }}</option>
            </select>
        </td>
        <td>{{ task.taskEndDate | date:'dd-MM-yyyy'}}</td>
        <td><select id="statusId" name="statusId" [(ngModel)]="task.taskStatus" required class="form-control" (change)="onChangeStatus(task)">
                <option value="undefined" selected>Select Status</option>
                <!-- Loop through the 'allStatus' array and display each status as an option -->
                <option *ngFor="let status of allStatus" [value]="status.statusId">{{
                    status.statusCode }}</option>
            </select></td>
        <td>{{task.taskActualEndDate | date:'dd-MM-yyyy'}}</td>
        <td>
            <div class="row mt-1">
                <div class="col">
                    <span title="Add Task" class="fa-solid fa-circle-plus fa-xl" style="color: #03a300;"></span>
                </div>
                <div class="col">
                    <span title="Save Task" class="fa-solid fa-circle-down fa-rotate-180 fa-xl"
                        style="color: #0095a8;"></span>
                </div>
                <div class="col">
                    <span title="Delete Task" class="fa-solid fa-trash fa-xl" style="color: #ff0000;"></span>
                </div>

            </div>
        </td>
    </tr>
    <!-- Expandable Child Panel -->
    <tr *ngIf="showChildTable.get(task.taskId)">
        <td colspan="9">
            <!-- Custom template for child table -->
            <app-task-table [parentTaskData]="task.childTask" [employees]="employees"></app-task-table>
        </td>
    </tr>
</ng-template>